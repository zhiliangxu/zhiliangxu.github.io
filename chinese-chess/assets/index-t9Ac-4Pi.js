(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const t of l.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function o(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(c){if(c.ep)return;c.ep=!0;const l=o(c);fetch(c.href,l)}})();const v=9,h=10,y=70,A=35,C=0,L=1,J={g:["帥","將"],a:["仕","士"],e:["相","象"],h:["傌","馬"],r:["俥","車"],c:["炮","砲"],s:["兵","卒"]};let a=[],R=C,k=null,T=!1,q="pvp",H=L,D="medium",x=null,O=[];const N=new(window.AudioContext||window.webkitAudioContext);function _(n){const e=N.createOscillator(),o=N.createGain();e.connect(o),o.connect(N.destination);const s=N.currentTime;n==="move"?(e.type="sine",e.frequency.setValueAtTime(600,s),e.frequency.exponentialRampToValueAtTime(400,s+.1),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.01,s+.1),e.start(s),e.stop(s+.1)):n==="capture"?(e.type="square",e.frequency.setValueAtTime(300,s),e.frequency.exponentialRampToValueAtTime(100,s+.2),o.gain.setValueAtTime(.1,s),o.gain.exponentialRampToValueAtTime(.01,s+.2),e.start(s),e.stop(s+.2)):n==="check"&&(e.type="triangle",e.frequency.setValueAtTime(800,s),e.frequency.setValueAtTime(400,s+.1),e.frequency.setValueAtTime(800,s+.2),e.frequency.setValueAtTime(400,s+.3),o.gain.setValueAtTime(.1,s),o.gain.linearRampToValueAtTime(.1,s+.4),o.gain.linearRampToValueAtTime(0,s+.5),e.start(s),e.stop(s+.5))}function Q(){te(),S(),Y()}function Y(){document.getElementById("btn-pvp")?.addEventListener("click",()=>$("pvp")),document.getElementById("btn-pve")?.addEventListener("click",()=>$("pve")),document.getElementById("btn-restart")?.addEventListener("click",()=>S()),document.getElementById("difficulty-select")?.addEventListener("change",n=>{D=n.target.value})}function S(){a=Array(h).fill(null).map(()=>Array(v).fill(null)),R=C,T=!1,k=null,x=null,O=[],M("紅方回合"),ee(),P(),F()}function $(n){q=n;const e=document.getElementById("btn-pvp"),o=document.getElementById("btn-pve"),s=document.getElementById("difficulty-container");e&&(e.className=n==="pvp"?"active":""),o&&(o.className=n==="pve"?"active":""),s&&(s.style.display=n==="pve"?"flex":"none"),S()}function ee(){const n=[["r","h","e","a","g","a","e","h","r"],[null,null,null,null,null,null,null,null,null],[null,"c",null,null,null,null,null,"c",null],["s",null,"s",null,"s",null,"s",null,"s"],[null,null,null,null,null,null,null,null,null]];for(let e=0;e<5;e++)for(let o=0;o<9;o++){const s=n[e][o];s&&(a[e][o]={type:s,color:L})}for(let e=0;e<5;e++)for(let o=0;o<9;o++){const s=n[e][o];s&&(a[9-e][o]={type:s,color:C})}}function te(){const n=document.getElementById("grid-layer");if(n){for(let e=0;e<9;e++){let o=document.createElement("div");o.className="h-line",o.style.top=e*y+"px",n.appendChild(o)}for(let e=0;e<8;e++)if(e===0){let o=document.createElement("div");o.className="v-line",o.style.left=e*y+"px",o.style.height=9*y+"px",n.appendChild(o)}else{let o=document.createElement("div");o.className="v-line",o.style.left=e*y+"px",o.style.height=4*y+"px",n.appendChild(o);let s=document.createElement("div");s.className="v-line",s.style.left=e*y+"px",s.style.top=5*y+"px",s.style.height=4*y+"px",n.appendChild(s)}w(n,3,0,5,2),w(n,5,0,3,2),w(n,3,9,5,7),w(n,5,9,3,7)}}function w(n,e,o,s,c){const l=e*y,t=o*y,i=s*y,f=c*y,d=Math.sqrt((i-l)**2+(f-t)**2),u=Math.atan2(f-t,i-l)*180/Math.PI,r=document.createElement("div");r.className="palace-line",r.style.width=d+"px",r.style.left=l+"px",r.style.top=t+"px",r.style.transform=`rotate(${u}deg)`,n.appendChild(r)}function P(){const n=document.getElementById("pieces-layer");if(n){n.innerHTML="",x&&[{r:x.fromR,c:x.fromC},{r:x.toR,c:x.toC}].forEach(e=>{const o=document.createElement("div");o.className="last-move-marker",o.style.left=A+e.c*y+"px",o.style.top=A+e.r*y+"px",o.innerHTML='<div class="corner-bottom-left"></div><div class="corner-bottom-right"></div>',n.appendChild(o)});for(let e=0;e<h;e++)for(let o=0;o<v;o++){const s=a[e][o];if(s){const c=document.createElement("div");c.className=`piece ${s.color===C?"red":"black"}`,c.innerText=J[s.type][s.color],c.style.left=A+o*y+"px",c.style.top=A+e*y+"px",c.onclick=()=>K(e,o),k&&k.r===e&&k.c===o&&c.classList.add("selected"),n.appendChild(c)}else{const c=document.createElement("div");c.style.position="absolute",c.style.width="40px",c.style.height="40px",c.style.left=A+o*y-20+"px",c.style.top=A+e*y-20+"px",c.style.cursor="pointer",c.style.zIndex="5",c.onclick=()=>K(e,o),n.appendChild(c)}}}}function oe(n){const e=document.getElementById("highlight-layer");e&&(e.innerHTML="",n.forEach(o=>{const s=document.createElement("div");s.className="dot",s.style.left=A+o.c*y+"px",s.style.top=A+o.r*y+"px",e.appendChild(s)}))}function F(){const n=document.getElementById("highlight-layer");n&&(n.innerHTML="")}function M(n){const e=document.getElementById("status");e&&(e.innerText=n)}function K(n,e){if(T||q==="pve"&&R===H)return;const o=a[n][e];if(o&&o.color===R){k={r:n,c:e},P();const s=I(n,e,a);oe(s);return}k&&I(k.r,k.c,a).find(l=>l.r===n&&l.c===e)&&(G(k.r,k.c,n,e),k=null,F(),!T&&q==="pve"&&R===H&&setTimeout(ve,100))}function G(n,e,o,s){const c=a[o][s];x={fromR:n,fromC:e,toR:o,toC:s};const l=R;if(_(c?"capture":"move"),c&&c.type==="g"){T=!0,P(),M(`遊戲結束! ${R===C?"紅方":"黑方"}勝利!`),a[o][s]=a[n][e],a[n][e]=null,P();return}a[o][s]=a[n][e],a[n][e]=null;const t=W(a,l),i=j(a);if(O.push({boardSig:i,move:x,color:l,isCheck:t.isCheck,chaseType:t.chaseType}),ce(i,l),T){P();return}R=1-R,P(),!T&&b(R,a)?(_("check"),M((R===C?"紅方":"黑方")+"回合 - 將軍!")):T||M(R===C?"紅方回合":"黑方回合")}function b(n,e){let o=-1,s=-1;for(let l=0;l<h;l++){for(let t=0;t<v;t++){const i=e[l][t];if(i&&i.type==="g"&&i.color===n){o=l,s=t;break}}if(o!==-1)break}if(o===-1)return!1;const c=1-n;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=e[l][t];if(i&&i.color===c&&I(l,t,e).some(d=>d.r===o&&d.c===s))return!0}return!1}function I(n,e,o){const s=o[n][e];if(!s)return[];let c=[];const l=s.type,t=s.color,i=(f,d)=>{if(f<0||f>=h||d<0||d>=v)return;const u=o[f][d];(!u||u.color!==t)&&c.push({r:f,c:d})};if(l==="g"){const f=[-1,1,0,0],d=[0,0,-1,1];for(let r=0;r<4;r++){const p=n+f[r],m=e+d[r];m>=3&&m<=5&&(t===C&&p>=7&&p<=9||t===L&&p>=0&&p<=2)&&i(p,m)}const u=t===C?-1:1;for(let r=n+u;r>=0&&r<h;r+=u)if(o[r][e]){o[r][e].type==="g"&&c.push({r,c:e});break}}else if(l==="a"){const f=[-1,1,-1,1],d=[-1,-1,1,1];for(let u=0;u<4;u++){const r=n+f[u],p=e+d[u];p>=3&&p<=5&&(t===C&&r>=7&&r<=9||t===L&&r>=0&&r<=2)&&i(r,p)}}else if(l==="e"){const f=[-2,2,-2,2],d=[-2,-2,2,2],u=[-1,1,-1,1],r=[-1,-1,1,1];for(let p=0;p<4;p++){const m=n+f[p],g=e+d[p];t===C&&m<5||t===L&&m>4||m>=0&&m<h&&g>=0&&g<v&&(o[n+u[p]][e+r[p]]||i(m,g))}}else if(l==="h"){const f=[-2,-2,2,2,-1,1,-1,1],d=[-1,1,-1,1,-2,-2,2,2],u=[-1,-1,1,1,0,0,0,0],r=[0,0,0,0,-1,-1,1,1];for(let p=0;p<8;p++){const m=n+f[p],g=e+d[p],B=n+u[p],E=e+r[p];m>=0&&m<h&&g>=0&&g<v&&(o[B][E]||i(m,g))}}else if(l==="r"){const f=[[0,1],[0,-1],[1,0],[-1,0]];for(let d of f){let u=n+d[0],r=e+d[1];for(;u>=0&&u<h&&r>=0&&r<v;){if(!o[u][r])c.push({r:u,c:r});else{o[u][r].color!==t&&c.push({r:u,c:r});break}u+=d[0],r+=d[1]}}}else if(l==="c"){const f=[[0,1],[0,-1],[1,0],[-1,0]];for(let d of f){let u=n+d[0],r=e+d[1],p=!1;for(;u>=0&&u<h&&r>=0&&r<v;){if(!o[u][r])p||c.push({r:u,c:r});else if(!p)p=!0;else{o[u][r].color!==t&&c.push({r:u,c:r});break}u+=d[0],r+=d[1]}}}else l==="s"&&(i(n+(t===C?-1:1),e),(t===C&&n<=4||t===L&&n>=5)&&(i(n,e-1),i(n,e+1)));return c}function j(n){return n.map(e=>e.map(o=>o?`${o.color}${o.type}`:"_").join("")).join("/")}function ne(n,e,o,s){const c=n[e][o];n[e][o]={type:"s",color:1-s};let l=!1;for(let t=0;t<h;t++){for(let i=0;i<v;i++){const f=n[t][i];if(f&&f.color===s&&I(t,i,n).some(u=>u.r===e&&u.c===o)){l=!0;break}}if(l)break}return n[e][o]=c,l}function se(n,e,o,s){const c=n[e][o];n[e][o]=null;const l=b(s,n);return n[e][o]=c,l}function W(n,e){const o=b(1-e,n);let s="none";const c=1-e;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=n[l][t];if(i&&i.color===c&&i.type!=="g"){let f=!1;for(let d=0;d<h;d++){for(let u=0;u<v;u++){const r=n[d][u];if(r&&r.color===e&&I(d,u,n).some(m=>m.r===l&&m.c===t)){f=!0;break}}if(f)break}if(f)if(ne(n,l,t,c)){let u=!1;const r=n[l][t];n[l][t]={type:"s",color:e};for(let p=0;p<h;p++){for(let m=0;m<v;m++){const g=n[p][m];if(g&&g.color===c&&I(p,m,n).some(E=>E.r===l&&E.c===t)&&!se(n,p,m,c)){u=!0;break}}if(u)break}if(n[l][t]=r,u)s==="none"&&(s="rooted");else return{isCheck:o,chaseType:"rootless"}}else return{isCheck:o,chaseType:"rootless"}}}return{isCheck:o,chaseType:s}}function z(n,e,o){const s=n.filter(c=>c.boardSig===e);if(s.length>=2){const c=n.findIndex(p=>p.boardSig===e);if(c===-1)return{violation:!1,msg:"",isDraw:!1};const t=n.slice(c).filter(p=>p.color===o),i=t.some(p=>p.isCheck),f=t.some(p=>p.chaseType==="rootless"),d=t.some(p=>p.chaseType==="rooted");let u=!1,r="";if(i&&f||i&&d?(u=!0,r="一將一捉"):i?t.some(m=>!m.isCheck&&m.chaseType==="none")||(u=!0,r="長將"):f&&(t.some(m=>!m.isCheck&&m.chaseType==="none")||(u=!0,r="長捉無根子")),u)return{violation:!0,msg:r,isDraw:!1};if(s.length>=3)return{violation:!1,msg:"雙方不變作和",isDraw:!0}}return{violation:!1,msg:"",isDraw:!1}}function ce(n,e){const o=z(O,n,e);o.violation?(T=!0,M(`${e===C?"紅方":"黑方"} ${o.msg} - 判負!`)):o.isDraw&&(T=!0,M(o.msg))}const le=1e4,ie=900,re=450,fe=400,ae=20,ue=20,de=30,pe=[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14],[7,0,13,0,16,0,13,0,7],[7,0,7,0,15,0,7,0,7],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],me=[[4,8,16,12,4,12,16,8,4],[4,10,28,16,8,16,28,10,4],[12,14,23,25,25,25,23,14,12],[10,24,34,40,40,40,34,24,10],[6,16,26,36,36,36,26,16,6],[2,10,18,24,24,24,18,10,2],[4,6,10,14,14,14,10,6,4],[0,4,8,10,10,10,8,4,0],[2,-4,4,8,8,8,4,-4,2],[0,-4,0,0,0,0,0,-4,0]],ye=[[6,6,6,8,10,8,6,6,6],[4,6,6,6,6,6,6,6,4],[2,4,4,4,8,4,4,4,2],[0,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0],[-2,0,4,0,8,0,4,0,-2],[0,0,0,0,0,0,0,0,0],[2,2,4,10,12,10,4,2,2],[2,2,0,2,0,2,0,2,2],[0,0,0,0,0,0,0,0,0]],he=[[14,14,12,18,16,18,12,14,14],[16,20,18,24,26,24,18,20,16],[12,12,12,18,18,18,12,12,12],[12,18,16,22,22,22,16,18,12],[12,16,14,18,18,18,14,16,12],[12,16,16,18,18,18,16,16,12],[6,10,12,14,14,14,12,10,6],[4,8,8,14,14,14,8,8,4],[0,4,6,10,10,10,6,4,0],[-2,2,4,6,6,6,4,2,-2]];function ge(n,e,o,s){const c=s===C?e:9-e,l=o;switch(n){case"s":return pe[c][l];case"h":return me[c][l];case"c":return ye[c][l];case"r":return he[c][l];default:return 0}}function ve(){if(T)return;let n=4;if(D==="easy"&&(n=2),D==="hard"){n=5;let o=0;for(let s=0;s<h;s++)for(let c=0;c<v;c++)a[s][c]&&o++;o>28?n=4:o<17&&(n=6)}const e=Re(n,H);e?G(e.fromR,e.fromC,e.toR,e.toC):console.log("AI has no moves")}function Ce(n,e){let o=0,s=!1,c=!1;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=n[l][t];if(i){let f=0;switch(i.type){case"g":f=le,i.color===e?s=!0:c=!0;break;case"r":f=ie;break;case"c":f=re;break;case"h":f=fe;break;case"e":f=ae;break;case"a":f=ue;break;case"s":f=de;break}f+=ge(i.type,l,t,i.color);const d=I(l,t,n);f+=d.length*2,i.color===e?o+=f:o-=f}}return s?c?o:1e6:-1e6}function Re(n,e){const s=X(a,e).filter(t=>{const i=a[t.toR][t.toC];a[t.toR][t.toC]=a[t.fromR][t.fromC],a[t.fromR][t.fromC]=null;const f=W(a,e),d=j(a),u=[...O,{boardSig:d,move:t,color:e,isCheck:f.isCheck,chaseType:f.chaseType}],r=z(u,d,e);return a[t.fromR][t.fromC]=a[t.toR][t.toC],a[t.toR][t.toC]=i,!r.violation});for(const t of s){const i=a[t.toR][t.toC];if(i&&i.type==="g")return t}let c=-1/0,l;s.sort((t,i)=>{const f=a[t.toR][t.toC],d=a[t.fromR][t.fromC],u=f&&V[f.type]||0,r=d&&V[d.type]||0,p=u*10-r,m=a[i.toR][i.toC],g=a[i.fromR][i.fromC],B=m&&V[m.type]||0,E=g&&V[g.type]||0;return B*10-E-p});for(const t of s){const i=a[t.toR][t.toC];a[t.toR][t.toC]=a[t.fromR][t.fromC],a[t.fromR][t.fromC]=null;const f=-U(n-1,-1/0,1/0,1-e);a[t.fromR][t.fromC]=a[t.toR][t.toC],a[t.toR][t.toC]=i,f>c&&(c=f,l=t)}return l}function U(n,e,o,s){if(n===0)return Ce(a,s);const c=X(a,s);if(c.length===0)return-1e6-n;c.sort((t,i)=>{const f=a[t.toR][t.toC],d=a[t.fromR][t.fromC],u=f&&V[f.type]||0,r=d&&V[d.type]||0,p=u*10-r,m=a[i.toR][i.toC],g=a[i.fromR][i.fromC],B=m&&V[m.type]||0,E=g&&V[g.type]||0;return B*10-E-p});let l=-1/0;for(const t of c){const i=a[t.toR][t.toC];if(i&&i.type==="g"){a[t.toR][t.toC]=a[t.fromR][t.fromC],a[t.fromR][t.fromC]=null;const d=1e6+n;return a[t.fromR][t.fromC]=a[t.toR][t.toC],a[t.toR][t.toC]=i,d}a[t.toR][t.toC]=a[t.fromR][t.fromC],a[t.fromR][t.fromC]=null;const f=-U(n-1,-o,-e,1-s);if(a[t.fromR][t.fromC]=a[t.toR][t.toC],a[t.toR][t.toC]=i,f>l&&(l=f),e=Math.max(e,f),e>=o)break}return l}const V={g:1e4,r:900,c:450,h:400,e:20,a:20,s:30};function X(n,e){let o=[];for(let s=0;s<h;s++)for(let c=0;c<v;c++){const l=n[s][c];l&&l.color===e&&I(s,c,n).forEach(i=>{o.push({fromR:s,fromC:c,toR:i.r,toC:i.c})})}return o}Q();
