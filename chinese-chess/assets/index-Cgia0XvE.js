(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}})();const C=9,g=10,y=70,A=35,v=0,k=1,$={g:["帥","將"],a:["仕","士"],e:["相","象"],h:["傌","馬"],r:["俥","車"],c:["炮","砲"],s:["兵","卒"]};let i=[],R=v,E=null,V=!1,_="pvp",b=k,q="medium",x=null;const M=new(window.AudioContext||window.webkitAudioContext);function w(n){const e=M.createOscillator(),t=M.createGain();e.connect(t),t.connect(M.destination);const o=M.currentTime;n==="move"?(e.type="sine",e.frequency.setValueAtTime(600,o),e.frequency.exponentialRampToValueAtTime(400,o+.1),t.gain.setValueAtTime(.1,o),t.gain.exponentialRampToValueAtTime(.01,o+.1),e.start(o),e.stop(o+.1)):n==="capture"?(e.type="square",e.frequency.setValueAtTime(300,o),e.frequency.exponentialRampToValueAtTime(100,o+.2),t.gain.setValueAtTime(.1,o),t.gain.exponentialRampToValueAtTime(.01,o+.2),e.start(o),e.stop(o+.2)):n==="check"&&(e.type="triangle",e.frequency.setValueAtTime(800,o),e.frequency.setValueAtTime(400,o+.1),e.frequency.setValueAtTime(800,o+.2),e.frequency.setValueAtTime(400,o+.3),t.gain.setValueAtTime(.1,o),t.gain.linearRampToValueAtTime(.1,o+.4),t.gain.linearRampToValueAtTime(0,o+.5),e.start(o),e.stop(o+.5))}function j(){X(),H(),z()}function z(){document.getElementById("btn-pvp")?.addEventListener("click",()=>D("pvp")),document.getElementById("btn-pve")?.addEventListener("click",()=>D("pve")),document.getElementById("btn-restart")?.addEventListener("click",()=>H()),document.getElementById("difficulty-select")?.addEventListener("change",n=>{q=n.target.value})}function H(){i=Array(g).fill(null).map(()=>Array(C).fill(null)),R=v,V=!1,E=null,x=null,O("紅方回合"),U(),I(),F()}function D(n){_=n;const e=document.getElementById("btn-pvp"),t=document.getElementById("btn-pve"),o=document.getElementById("difficulty-container");e&&(e.className=n==="pvp"?"active":""),t&&(t.className=n==="pve"?"active":""),o&&(o.style.display=n==="pve"?"flex":"none"),H()}function U(){const n=[["r","h","e","a","g","a","e","h","r"],[null,null,null,null,null,null,null,null,null],[null,"c",null,null,null,null,null,"c",null],["s",null,"s",null,"s",null,"s",null,"s"],[null,null,null,null,null,null,null,null,null]];for(let e=0;e<5;e++)for(let t=0;t<9;t++){const o=n[e][t];o&&(i[e][t]={type:o,color:k})}for(let e=0;e<5;e++)for(let t=0;t<9;t++){const o=n[e][t];o&&(i[9-e][t]={type:o,color:v})}}function X(){const n=document.getElementById("grid-layer");if(n){for(let e=0;e<10;e++){let t=document.createElement("div");t.className="h-line",t.style.top=e*y+"px",n.appendChild(t)}for(let e=0;e<9;e++){let t=document.createElement("div");t.className="v-line",t.style.left=e*y+"px",t.style.height=4*y+"px",n.appendChild(t);let o=document.createElement("div");o.className="v-line",o.style.left=e*y+"px",o.style.top=5*y+"px",o.style.height=4*y+"px",n.appendChild(o)}P(n,3,0,5,2),P(n,5,0,3,2),P(n,3,9,5,7),P(n,5,9,3,7)}}function P(n,e,t,o,s){const c=e*y,l=t*y,f=o*y,a=s*y,u=Math.sqrt((f-c)**2+(a-l)**2),m=Math.atan2(a-l,f-c)*180/Math.PI,r=document.createElement("div");r.className="palace-line",r.style.width=u+"px",r.style.left=c+"px",r.style.top=l+"px",r.style.transform=`rotate(${m}deg)`,n.appendChild(r)}function I(){const n=document.getElementById("pieces-layer");if(n){n.innerHTML="",x&&[{r:x.fromR,c:x.fromC},{r:x.toR,c:x.toC}].forEach(e=>{const t=document.createElement("div");t.className="last-move-marker",t.style.left=A+e.c*y+"px",t.style.top=A+e.r*y+"px",t.innerHTML='<div class="corner-bottom-left"></div><div class="corner-bottom-right"></div>',n.appendChild(t)});for(let e=0;e<g;e++)for(let t=0;t<C;t++){const o=i[e][t];if(o){const s=document.createElement("div");s.className=`piece ${o.color===v?"red":"black"}`,s.innerText=$[o.type][o.color],s.style.left=A+t*y+"px",s.style.top=A+e*y+"px",s.onclick=()=>K(e,t),E&&E.r===e&&E.c===t&&s.classList.add("selected"),n.appendChild(s)}else{const s=document.createElement("div");s.style.position="absolute",s.style.width="40px",s.style.height="40px",s.style.left=A+t*y-20+"px",s.style.top=A+e*y-20+"px",s.style.cursor="pointer",s.style.zIndex="5",s.onclick=()=>K(e,t),n.appendChild(s)}}}}function Z(n){const e=document.getElementById("highlight-layer");e&&(e.innerHTML="",n.forEach(t=>{const o=document.createElement("div");o.className="dot",o.style.left=A+t.c*y+"px",o.style.top=A+t.r*y+"px",e.appendChild(o)}))}function F(){const n=document.getElementById("highlight-layer");n&&(n.innerHTML="")}function O(n){const e=document.getElementById("status");e&&(e.innerText=n)}function K(n,e){if(V||_==="pve"&&R===b)return;const t=i[n][e];if(t&&t.color===R){E={r:n,c:e},I();const o=L(n,e,i);Z(o);return}E&&L(E.r,E.c,i).find(c=>c.r===n&&c.c===e)&&(G(E.r,E.c,n,e),E=null,F(),!V&&_==="pve"&&R===b&&setTimeout(ae,100))}function G(n,e,t,o){const s=i[t][o];if(x={fromR:n,fromC:e,toR:t,toC:o},w(s?"capture":"move"),s&&s.type==="g"){V=!0,I(),O(`遊戲結束! ${R===v?"紅方":"黑方"}勝利!`),i[t][o]=i[n][e],i[n][e]=null,I();return}i[t][o]=i[n][e],i[n][e]=null,R=1-R,I(),!V&&J(R,i)?(w("check"),O((R===v?"紅方":"黑方")+"回合 - 將軍!")):V||O(R===v?"紅方回合":"黑方回合")}function J(n,e){let t=-1,o=-1;for(let c=0;c<g;c++){for(let l=0;l<C;l++){const f=e[c][l];if(f&&f.type==="g"&&f.color===n){t=c,o=l;break}}if(t!==-1)break}if(t===-1)return!1;const s=1-n;for(let c=0;c<g;c++)for(let l=0;l<C;l++){const f=e[c][l];if(f&&f.color===s&&L(c,l,e).some(u=>u.r===t&&u.c===o))return!0}return!1}function L(n,e,t){const o=t[n][e];if(!o)return[];let s=[];const c=o.type,l=o.color,f=(a,u)=>{if(a<0||a>=g||u<0||u>=C)return;const m=t[a][u];(!m||m.color!==l)&&s.push({r:a,c:u})};if(c==="g"){const a=[-1,1,0,0],u=[0,0,-1,1];for(let r=0;r<4;r++){const d=n+a[r],p=e+u[r];p>=3&&p<=5&&(l===v&&d>=7&&d<=9||l===k&&d>=0&&d<=2)&&f(d,p)}const m=l===v?-1:1;for(let r=n+m;r>=0&&r<g;r+=m)if(t[r][e]){t[r][e].type==="g"&&s.push({r,c:e});break}}else if(c==="a"){const a=[-1,1,-1,1],u=[-1,-1,1,1];for(let m=0;m<4;m++){const r=n+a[m],d=e+u[m];d>=3&&d<=5&&(l===v&&r>=7&&r<=9||l===k&&r>=0&&r<=2)&&f(r,d)}}else if(c==="e"){const a=[-2,2,-2,2],u=[-2,-2,2,2],m=[-1,1,-1,1],r=[-1,-1,1,1];for(let d=0;d<4;d++){const p=n+a[d],h=e+u[d];l===v&&p<5||l===k&&p>4||p>=0&&p<g&&h>=0&&h<C&&(t[n+m[d]][e+r[d]]||f(p,h))}}else if(c==="h"){const a=[-2,-2,2,2,-1,1,-1,1],u=[-1,1,-1,1,-2,-2,2,2],m=[-1,-1,1,1,0,0,0,0],r=[0,0,0,0,-1,-1,1,1];for(let d=0;d<8;d++){const p=n+a[d],h=e+u[d],B=n+m[d],N=e+r[d];p>=0&&p<g&&h>=0&&h<C&&(t[B][N]||f(p,h))}}else if(c==="r"){const a=[[0,1],[0,-1],[1,0],[-1,0]];for(let u of a){let m=n+u[0],r=e+u[1];for(;m>=0&&m<g&&r>=0&&r<C;){if(!t[m][r])s.push({r:m,c:r});else{t[m][r].color!==l&&s.push({r:m,c:r});break}m+=u[0],r+=u[1]}}}else if(c==="c"){const a=[[0,1],[0,-1],[1,0],[-1,0]];for(let u of a){let m=n+u[0],r=e+u[1],d=!1;for(;m>=0&&m<g&&r>=0&&r<C;){if(!t[m][r])d||s.push({r:m,c:r});else if(!d)d=!0;else{t[m][r].color!==l&&s.push({r:m,c:r});break}m+=u[0],r+=u[1]}}}else c==="s"&&(f(n+(l===v?-1:1),e),(l===v&&n<=4||l===k&&n>=5)&&(f(n,e-1),f(n,e+1)));return s}const Q=1e4,Y=900,ee=450,te=400,ne=20,oe=20,le=30,ce=[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14],[7,0,13,0,16,0,13,0,7],[7,0,7,0,15,0,7,0,7],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],se=[[4,8,16,12,4,12,16,8,4],[4,10,28,16,8,16,28,10,4],[12,14,23,25,25,25,23,14,12],[10,24,34,40,40,40,34,24,10],[6,16,26,36,36,36,26,16,6],[2,10,18,24,24,24,18,10,2],[4,6,10,14,14,14,10,6,4],[0,4,8,10,10,10,8,4,0],[2,-4,4,8,8,8,4,-4,2],[0,-4,0,0,0,0,0,-4,0]],re=[[6,6,6,8,10,8,6,6,6],[4,6,6,6,6,6,6,6,4],[2,4,4,4,8,4,4,4,2],[0,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0],[-2,0,4,0,8,0,4,0,-2],[0,0,0,0,0,0,0,0,0],[2,2,4,10,12,10,4,2,2],[2,2,0,2,0,2,0,2,2],[0,0,0,0,0,0,0,0,0]],ie=[[14,14,12,18,16,18,12,14,14],[16,20,18,24,26,24,18,20,16],[12,12,12,18,18,18,12,12,12],[12,18,16,22,22,22,16,18,12],[12,16,14,18,18,18,14,16,12],[12,16,16,18,18,18,16,16,12],[6,10,12,14,14,14,12,10,6],[4,8,8,14,14,14,8,8,4],[0,4,6,10,10,10,6,4,0],[-2,2,4,6,6,6,4,2,-2]];function fe(n,e,t,o){const s=o===v?e:9-e,c=t;switch(n){case"s":return ce[s][c];case"h":return se[s][c];case"c":return re[s][c];case"r":return ie[s][c];default:return 0}}function ae(){if(V)return;let n=4;if(q==="easy"&&(n=2),q==="hard"){n=5;let t=0;for(let o=0;o<g;o++)for(let s=0;s<C;s++)i[o][s]&&t++;t>28?n=4:t<17&&(n=6)}const e=me(n,b);e?G(e.fromR,e.fromC,e.toR,e.toC):console.log("AI has no moves")}function ue(n,e){let t=0,o=!1,s=!1;for(let c=0;c<g;c++)for(let l=0;l<C;l++){const f=n[c][l];if(f){let a=0;switch(f.type){case"g":a=Q,f.color===e?o=!0:s=!0;break;case"r":a=Y;break;case"c":a=ee;break;case"h":a=te;break;case"e":a=ne;break;case"a":a=oe;break;case"s":a=le;break}a+=fe(f.type,c,l,f.color);const u=L(c,l,n);a+=u.length*2,f.color===e?t+=a:t-=a}}return o?s?t:1e6:-1e6}function me(n,e){const t=W(i,e);for(const c of t){const l=i[c.toR][c.toC];if(l&&l.type==="g")return c}let o=-1/0,s;t.sort((c,l)=>{const f=i[c.toR][c.toC],a=i[c.fromR][c.fromC],u=f&&T[f.type]||0,m=a&&T[a.type]||0,r=u*10-m,d=i[l.toR][l.toC],p=i[l.fromR][l.fromC],h=d&&T[d.type]||0,B=p&&T[p.type]||0;return h*10-B-r});for(const c of t){const l=i[c.toR][c.toC];i[c.toR][c.toC]=i[c.fromR][c.fromC],i[c.fromR][c.fromC]=null;const f=-S(n-1,-1/0,1/0,1-e);i[c.fromR][c.fromC]=i[c.toR][c.toC],i[c.toR][c.toC]=l,f>o&&(o=f,s=c)}return s}function S(n,e,t,o){if(n===0)return ue(i,o);const s=W(i,o);if(s.length===0)return-1e6-n;s.sort((l,f)=>{const a=i[l.toR][l.toC],u=i[l.fromR][l.fromC],m=a&&T[a.type]||0,r=u&&T[u.type]||0,d=m*10-r,p=i[f.toR][f.toC],h=i[f.fromR][f.fromC],B=p&&T[p.type]||0,N=h&&T[h.type]||0;return B*10-N-d});let c=-1/0;for(const l of s){const f=i[l.toR][l.toC];if(f&&f.type==="g"){i[l.toR][l.toC]=i[l.fromR][l.fromC],i[l.fromR][l.fromC]=null;const u=1e6+n;return i[l.fromR][l.fromC]=i[l.toR][l.toC],i[l.toR][l.toC]=f,u}i[l.toR][l.toC]=i[l.fromR][l.fromC],i[l.fromR][l.fromC]=null;const a=-S(n-1,-t,-e,1-o);if(i[l.fromR][l.fromC]=i[l.toR][l.toC],i[l.toR][l.toC]=f,a>c&&(c=a),e=Math.max(e,a),e>=t)break}return c}const T={g:1e4,r:900,c:450,h:400,e:20,a:20,s:30};function W(n,e){let t=[];for(let o=0;o<g;o++)for(let s=0;s<C;s++){const c=n[o][s];c&&c.color===e&&L(o,s,n).forEach(f=>{t.push({fromR:o,fromC:s,toR:f.r,toC:f.c})})}return t}j();
