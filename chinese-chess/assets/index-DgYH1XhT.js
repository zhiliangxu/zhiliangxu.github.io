(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const t of l.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function n(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(c){if(c.ep)return;c.ep=!0;const l=n(c);fetch(c.href,l)}})();const v=9,h=10,y=70,A=35,C=0,P=1,J={g:["帥","將"],a:["仕","士"],e:["相","象"],h:["傌","馬"],r:["俥","車"],c:["炮","砲"],s:["兵","卒"]};let f=[],R=C,k=null,T=!1,q="pvp",D=P,H="medium",x=null,N=[];const w=new(window.AudioContext||window.webkitAudioContext);function _(o){const e=w.createOscillator(),n=w.createGain();e.connect(n),n.connect(w.destination);const s=w.currentTime;o==="move"?(e.type="sine",e.frequency.setValueAtTime(600,s),e.frequency.exponentialRampToValueAtTime(400,s+.1),n.gain.setValueAtTime(.1,s),n.gain.exponentialRampToValueAtTime(.01,s+.1),e.start(s),e.stop(s+.1)):o==="capture"?(e.type="square",e.frequency.setValueAtTime(300,s),e.frequency.exponentialRampToValueAtTime(100,s+.2),n.gain.setValueAtTime(.1,s),n.gain.exponentialRampToValueAtTime(.01,s+.2),e.start(s),e.stop(s+.2)):o==="check"&&(e.type="triangle",e.frequency.setValueAtTime(800,s),e.frequency.setValueAtTime(400,s+.1),e.frequency.setValueAtTime(800,s+.2),e.frequency.setValueAtTime(400,s+.3),n.gain.setValueAtTime(.1,s),n.gain.linearRampToValueAtTime(.1,s+.4),n.gain.linearRampToValueAtTime(0,s+.5),e.start(s),e.stop(s+.5))}function Q(){te(),S(),Y()}function Y(){document.getElementById("btn-pvp")?.addEventListener("click",()=>$("pvp")),document.getElementById("btn-pve")?.addEventListener("click",()=>$("pve")),document.getElementById("btn-restart")?.addEventListener("click",()=>S()),document.getElementById("difficulty-select")?.addEventListener("change",o=>{H=o.target.value})}function S(){f=Array(h).fill(null).map(()=>Array(v).fill(null)),R=C,T=!1,k=null,x=null,N=[],M("紅方回合"),ee(),L(),F()}function $(o){q=o;const e=document.getElementById("btn-pvp"),n=document.getElementById("btn-pve"),s=document.getElementById("difficulty-container");e&&(e.className=o==="pvp"?"active":""),n&&(n.className=o==="pve"?"active":""),s&&(s.style.display=o==="pve"?"flex":"none"),S()}function ee(){const o=[["r","h","e","a","g","a","e","h","r"],[null,null,null,null,null,null,null,null,null],[null,"c",null,null,null,null,null,"c",null],["s",null,"s",null,"s",null,"s",null,"s"],[null,null,null,null,null,null,null,null,null]];for(let e=0;e<5;e++)for(let n=0;n<9;n++){const s=o[e][n];s&&(f[e][n]={type:s,color:P})}for(let e=0;e<5;e++)for(let n=0;n<9;n++){const s=o[e][n];s&&(f[9-e][n]={type:s,color:C})}}function te(){const o=document.getElementById("grid-layer");if(o){for(let e=0;e<10;e++){let n=document.createElement("div");n.className="h-line",n.style.top=e*y+"px",o.appendChild(n)}for(let e=0;e<9;e++){let n=document.createElement("div");n.className="v-line",n.style.left=e*y+"px",n.style.height=4*y+"px",o.appendChild(n);let s=document.createElement("div");s.className="v-line",s.style.left=e*y+"px",s.style.top=5*y+"px",s.style.height=4*y+"px",o.appendChild(s)}O(o,3,0,5,2),O(o,5,0,3,2),O(o,3,9,5,7),O(o,5,9,3,7)}}function O(o,e,n,s,c){const l=e*y,t=n*y,i=s*y,a=c*y,d=Math.sqrt((i-l)**2+(a-t)**2),u=Math.atan2(a-t,i-l)*180/Math.PI,r=document.createElement("div");r.className="palace-line",r.style.width=d+"px",r.style.left=l+"px",r.style.top=t+"px",r.style.transform=`rotate(${u}deg)`,o.appendChild(r)}function L(){const o=document.getElementById("pieces-layer");if(o){o.innerHTML="",x&&[{r:x.fromR,c:x.fromC},{r:x.toR,c:x.toC}].forEach(e=>{const n=document.createElement("div");n.className="last-move-marker",n.style.left=A+e.c*y+"px",n.style.top=A+e.r*y+"px",n.innerHTML='<div class="corner-bottom-left"></div><div class="corner-bottom-right"></div>',o.appendChild(n)});for(let e=0;e<h;e++)for(let n=0;n<v;n++){const s=f[e][n];if(s){const c=document.createElement("div");c.className=`piece ${s.color===C?"red":"black"}`,c.innerText=J[s.type][s.color],c.style.left=A+n*y+"px",c.style.top=A+e*y+"px",c.onclick=()=>K(e,n),k&&k.r===e&&k.c===n&&c.classList.add("selected"),o.appendChild(c)}else{const c=document.createElement("div");c.style.position="absolute",c.style.width="40px",c.style.height="40px",c.style.left=A+n*y-20+"px",c.style.top=A+e*y-20+"px",c.style.cursor="pointer",c.style.zIndex="5",c.onclick=()=>K(e,n),o.appendChild(c)}}}}function oe(o){const e=document.getElementById("highlight-layer");e&&(e.innerHTML="",o.forEach(n=>{const s=document.createElement("div");s.className="dot",s.style.left=A+n.c*y+"px",s.style.top=A+n.r*y+"px",e.appendChild(s)}))}function F(){const o=document.getElementById("highlight-layer");o&&(o.innerHTML="")}function M(o){const e=document.getElementById("status");e&&(e.innerText=o)}function K(o,e){if(T||q==="pve"&&R===D)return;const n=f[o][e];if(n&&n.color===R){k={r:o,c:e},L();const s=I(o,e,f);oe(s);return}k&&I(k.r,k.c,f).find(l=>l.r===o&&l.c===e)&&(G(k.r,k.c,o,e),k=null,F(),!T&&q==="pve"&&R===D&&setTimeout(ve,100))}function G(o,e,n,s){const c=f[n][s];x={fromR:o,fromC:e,toR:n,toC:s};const l=R;if(_(c?"capture":"move"),c&&c.type==="g"){T=!0,L(),M(`遊戲結束! ${R===C?"紅方":"黑方"}勝利!`),f[n][s]=f[o][e],f[o][e]=null,L();return}f[n][s]=f[o][e],f[o][e]=null;const t=W(f,l),i=j(f);if(N.push({boardSig:i,move:x,color:l,isCheck:t.isCheck,chaseType:t.chaseType}),ce(i,l),T){L();return}R=1-R,L(),!T&&b(R,f)?(_("check"),M((R===C?"紅方":"黑方")+"回合 - 將軍!")):T||M(R===C?"紅方回合":"黑方回合")}function b(o,e){let n=-1,s=-1;for(let l=0;l<h;l++){for(let t=0;t<v;t++){const i=e[l][t];if(i&&i.type==="g"&&i.color===o){n=l,s=t;break}}if(n!==-1)break}if(n===-1)return!1;const c=1-o;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=e[l][t];if(i&&i.color===c&&I(l,t,e).some(d=>d.r===n&&d.c===s))return!0}return!1}function I(o,e,n){const s=n[o][e];if(!s)return[];let c=[];const l=s.type,t=s.color,i=(a,d)=>{if(a<0||a>=h||d<0||d>=v)return;const u=n[a][d];(!u||u.color!==t)&&c.push({r:a,c:d})};if(l==="g"){const a=[-1,1,0,0],d=[0,0,-1,1];for(let r=0;r<4;r++){const p=o+a[r],m=e+d[r];m>=3&&m<=5&&(t===C&&p>=7&&p<=9||t===P&&p>=0&&p<=2)&&i(p,m)}const u=t===C?-1:1;for(let r=o+u;r>=0&&r<h;r+=u)if(n[r][e]){n[r][e].type==="g"&&c.push({r,c:e});break}}else if(l==="a"){const a=[-1,1,-1,1],d=[-1,-1,1,1];for(let u=0;u<4;u++){const r=o+a[u],p=e+d[u];p>=3&&p<=5&&(t===C&&r>=7&&r<=9||t===P&&r>=0&&r<=2)&&i(r,p)}}else if(l==="e"){const a=[-2,2,-2,2],d=[-2,-2,2,2],u=[-1,1,-1,1],r=[-1,-1,1,1];for(let p=0;p<4;p++){const m=o+a[p],g=e+d[p];t===C&&m<5||t===P&&m>4||m>=0&&m<h&&g>=0&&g<v&&(n[o+u[p]][e+r[p]]||i(m,g))}}else if(l==="h"){const a=[-2,-2,2,2,-1,1,-1,1],d=[-1,1,-1,1,-2,-2,2,2],u=[-1,-1,1,1,0,0,0,0],r=[0,0,0,0,-1,-1,1,1];for(let p=0;p<8;p++){const m=o+a[p],g=e+d[p],B=o+u[p],E=e+r[p];m>=0&&m<h&&g>=0&&g<v&&(n[B][E]||i(m,g))}}else if(l==="r"){const a=[[0,1],[0,-1],[1,0],[-1,0]];for(let d of a){let u=o+d[0],r=e+d[1];for(;u>=0&&u<h&&r>=0&&r<v;){if(!n[u][r])c.push({r:u,c:r});else{n[u][r].color!==t&&c.push({r:u,c:r});break}u+=d[0],r+=d[1]}}}else if(l==="c"){const a=[[0,1],[0,-1],[1,0],[-1,0]];for(let d of a){let u=o+d[0],r=e+d[1],p=!1;for(;u>=0&&u<h&&r>=0&&r<v;){if(!n[u][r])p||c.push({r:u,c:r});else if(!p)p=!0;else{n[u][r].color!==t&&c.push({r:u,c:r});break}u+=d[0],r+=d[1]}}}else l==="s"&&(i(o+(t===C?-1:1),e),(t===C&&o<=4||t===P&&o>=5)&&(i(o,e-1),i(o,e+1)));return c}function j(o){return o.map(e=>e.map(n=>n?`${n.color}${n.type}`:"_").join("")).join("/")}function ne(o,e,n,s){const c=o[e][n];o[e][n]={type:"s",color:1-s};let l=!1;for(let t=0;t<h;t++){for(let i=0;i<v;i++){const a=o[t][i];if(a&&a.color===s&&I(t,i,o).some(u=>u.r===e&&u.c===n)){l=!0;break}}if(l)break}return o[e][n]=c,l}function se(o,e,n,s){const c=o[e][n];o[e][n]=null;const l=b(s,o);return o[e][n]=c,l}function W(o,e){const n=b(1-e,o);let s="none";const c=1-e;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=o[l][t];if(i&&i.color===c&&i.type!=="g"){let a=!1;for(let d=0;d<h;d++){for(let u=0;u<v;u++){const r=o[d][u];if(r&&r.color===e&&I(d,u,o).some(m=>m.r===l&&m.c===t)){a=!0;break}}if(a)break}if(a)if(ne(o,l,t,c)){let u=!1;const r=o[l][t];o[l][t]={type:"s",color:e};for(let p=0;p<h;p++){for(let m=0;m<v;m++){const g=o[p][m];if(g&&g.color===c&&I(p,m,o).some(E=>E.r===l&&E.c===t)&&!se(o,p,m,c)){u=!0;break}}if(u)break}if(o[l][t]=r,u)s==="none"&&(s="rooted");else return{isCheck:n,chaseType:"rootless"}}else return{isCheck:n,chaseType:"rootless"}}}return{isCheck:n,chaseType:s}}function z(o,e,n){const s=o.filter(c=>c.boardSig===e);if(s.length>=2){const c=o.findIndex(p=>p.boardSig===e);if(c===-1)return{violation:!1,msg:"",isDraw:!1};const t=o.slice(c).filter(p=>p.color===n),i=t.some(p=>p.isCheck),a=t.some(p=>p.chaseType==="rootless"),d=t.some(p=>p.chaseType==="rooted");let u=!1,r="";if(i&&a||i&&d?(u=!0,r="一將一捉 (One Check, One Chase)"):i?t.some(m=>!m.isCheck&&m.chaseType==="none")||(u=!0,r="長將 (Perpetual Check)"):a&&(t.some(m=>!m.isCheck&&m.chaseType==="none")||(u=!0,r="長捉無根子 (Perpetual Chase of Rootless)")),u)return{violation:!0,msg:r,isDraw:!1};if(s.length>=3)return{violation:!1,msg:"雙方不變作和 (Draw)",isDraw:!0}}return{violation:!1,msg:"",isDraw:!1}}function ce(o,e){const n=z(N,o,e);n.violation?(T=!0,M(`${e===C?"紅方":"黑方"} ${n.msg} - 判負!`)):n.isDraw&&(T=!0,M(n.msg))}const le=1e4,ie=900,re=450,ae=400,fe=20,ue=20,de=30,pe=[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14],[7,0,13,0,16,0,13,0,7],[7,0,7,0,15,0,7,0,7],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],me=[[4,8,16,12,4,12,16,8,4],[4,10,28,16,8,16,28,10,4],[12,14,23,25,25,25,23,14,12],[10,24,34,40,40,40,34,24,10],[6,16,26,36,36,36,26,16,6],[2,10,18,24,24,24,18,10,2],[4,6,10,14,14,14,10,6,4],[0,4,8,10,10,10,8,4,0],[2,-4,4,8,8,8,4,-4,2],[0,-4,0,0,0,0,0,-4,0]],ye=[[6,6,6,8,10,8,6,6,6],[4,6,6,6,6,6,6,6,4],[2,4,4,4,8,4,4,4,2],[0,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0],[-2,0,4,0,8,0,4,0,-2],[0,0,0,0,0,0,0,0,0],[2,2,4,10,12,10,4,2,2],[2,2,0,2,0,2,0,2,2],[0,0,0,0,0,0,0,0,0]],he=[[14,14,12,18,16,18,12,14,14],[16,20,18,24,26,24,18,20,16],[12,12,12,18,18,18,12,12,12],[12,18,16,22,22,22,16,18,12],[12,16,14,18,18,18,14,16,12],[12,16,16,18,18,18,16,16,12],[6,10,12,14,14,14,12,10,6],[4,8,8,14,14,14,8,8,4],[0,4,6,10,10,10,6,4,0],[-2,2,4,6,6,6,4,2,-2]];function ge(o,e,n,s){const c=s===C?e:9-e,l=n;switch(o){case"s":return pe[c][l];case"h":return me[c][l];case"c":return ye[c][l];case"r":return he[c][l];default:return 0}}function ve(){if(T)return;let o=4;if(H==="easy"&&(o=2),H==="hard"){o=5;let n=0;for(let s=0;s<h;s++)for(let c=0;c<v;c++)f[s][c]&&n++;n>28?o=4:n<17&&(o=6)}const e=Re(o,D);e?G(e.fromR,e.fromC,e.toR,e.toC):console.log("AI has no moves")}function Ce(o,e){let n=0,s=!1,c=!1;for(let l=0;l<h;l++)for(let t=0;t<v;t++){const i=o[l][t];if(i){let a=0;switch(i.type){case"g":a=le,i.color===e?s=!0:c=!0;break;case"r":a=ie;break;case"c":a=re;break;case"h":a=ae;break;case"e":a=fe;break;case"a":a=ue;break;case"s":a=de;break}a+=ge(i.type,l,t,i.color);const d=I(l,t,o);a+=d.length*2,i.color===e?n+=a:n-=a}}return s?c?n:1e6:-1e6}function Re(o,e){const s=X(f,e).filter(t=>{const i=f[t.toR][t.toC];f[t.toR][t.toC]=f[t.fromR][t.fromC],f[t.fromR][t.fromC]=null;const a=W(f,e),d=j(f),u=[...N,{boardSig:d,move:t,color:e,isCheck:a.isCheck,chaseType:a.chaseType}],r=z(u,d,e);return f[t.fromR][t.fromC]=f[t.toR][t.toC],f[t.toR][t.toC]=i,!r.violation});for(const t of s){const i=f[t.toR][t.toC];if(i&&i.type==="g")return t}let c=-1/0,l;s.sort((t,i)=>{const a=f[t.toR][t.toC],d=f[t.fromR][t.fromC],u=a&&V[a.type]||0,r=d&&V[d.type]||0,p=u*10-r,m=f[i.toR][i.toC],g=f[i.fromR][i.fromC],B=m&&V[m.type]||0,E=g&&V[g.type]||0;return B*10-E-p});for(const t of s){const i=f[t.toR][t.toC];f[t.toR][t.toC]=f[t.fromR][t.fromC],f[t.fromR][t.fromC]=null;const a=-U(o-1,-1/0,1/0,1-e);f[t.fromR][t.fromC]=f[t.toR][t.toC],f[t.toR][t.toC]=i,a>c&&(c=a,l=t)}return l}function U(o,e,n,s){if(o===0)return Ce(f,s);const c=X(f,s);if(c.length===0)return-1e6-o;c.sort((t,i)=>{const a=f[t.toR][t.toC],d=f[t.fromR][t.fromC],u=a&&V[a.type]||0,r=d&&V[d.type]||0,p=u*10-r,m=f[i.toR][i.toC],g=f[i.fromR][i.fromC],B=m&&V[m.type]||0,E=g&&V[g.type]||0;return B*10-E-p});let l=-1/0;for(const t of c){const i=f[t.toR][t.toC];if(i&&i.type==="g"){f[t.toR][t.toC]=f[t.fromR][t.fromC],f[t.fromR][t.fromC]=null;const d=1e6+o;return f[t.fromR][t.fromC]=f[t.toR][t.toC],f[t.toR][t.toC]=i,d}f[t.toR][t.toC]=f[t.fromR][t.fromC],f[t.fromR][t.fromC]=null;const a=-U(o-1,-n,-e,1-s);if(f[t.fromR][t.fromC]=f[t.toR][t.toC],f[t.toR][t.toC]=i,a>l&&(l=a),e=Math.max(e,a),e>=n)break}return l}const V={g:1e4,r:900,c:450,h:400,e:20,a:20,s:30};function X(o,e){let n=[];for(let s=0;s<h;s++)for(let c=0;c<v;c++){const l=o[s][c];l&&l.color===e&&I(s,c,o).forEach(i=>{n.push({fromR:s,fromC:c,toR:i.r,toC:i.c})})}return n}Q();
